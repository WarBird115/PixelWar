<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pixel Wars</title>
    <style>
        body {
            font-family: 'Verdana', sans-serif;
            background-color: #2c2c2c;
            color: #e0e0e0;
            text-align: center;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 {
            margin-top: 20px;
            color: #ffcc00;
        }

        #pixelCanvas {
            border: 1px solid #555;
            margin-top: 20px;
            cursor: pointer;
            background-color: #ffffff;
        }

        #canvasContainer {
            position: relative;
        }

        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
        }

        #colorOptions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            align-items: center;
        }

        #accessSection {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #accessSection input {
            padding: 5px;
            margin-top: 10px;
            border-radius: 5px;
            border: 1px solid #555;
        }

        #wipeCanvasButton {
            margin-top: 20px;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            background-color: #ff5555;
            color: #ffffff;
            cursor: pointer;
            display: none; /* Initially hidden */
        }

        #countdown {
            color: #ffcc00; /* Countdown text color */
            margin-left: 10px;
        }

        #welcomeText {
            margin-top: 30px;
            max-width: 600px;
            text-align: left;
            font-size: 14px;
            background-color: #3c3c3c;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            color: #e0e0e0;
        }

        #welcomeText h2 {
            margin-bottom: 10px;
            font-size: 18px;
            color: #ffcc00;
        }

        #welcomeText ul {
            padding-left: 20px;
        }

        #welcomeText li {
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <h1>Pixel Wars</h1>
    <div id="canvasContainer">
        <canvas id="pixelCanvas" width="500" height="500"></canvas>
        <div class="overlay" id="overlay">Enter Access Code to Unlock Canvas</div>
    </div>
    
    <div id="colorOptions">
        <input type="color" id="colorPicker" value="#000000">
        <div id="countdown">Cooldown: 0:00</div>
    </div>

    <div id="accessSection">
        <label for="userInput">Enter Access Code:</label>
        <input type="text" id="userInput" placeholder="Enter your code here">
        <button id="submitCode">Submit</button>
    </div>

    <button id="wipeCanvasButton">Wipe Canvas</button>

    <div id="welcomeText">
        <h2>Welcome to Pixel Wars!</h2>
        <p>This space is all about collaboration and creativity. Go wild, be quirky, or team up with others to create something amazing. The image you create here will become our server banner at the end of every month. You've got one pixel every 5 minutes, so make it count!</p>
        <p>Here are some quick tips to get you started:</p>
        <ul>
            <li>Click on the canvas to place a pixel.</li>
            <li>Middle-click on the canvas to quickly pick a color thatâ€™s already been placed.</li>
            <li>You can replace any pixel, no matter who placed it there!</li>
        </ul>
        <p>Game on and happy pixeling!</p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const canvas = document.getElementById('pixelCanvas');
            const ctx = canvas.getContext('2d');
            const overlay = document.getElementById('overlay');
            const colorPicker = document.getElementById('colorPicker');
            const countdownDisplay = document.getElementById('countdown');
            const submitCodeButton = document.getElementById('submitCode');
            const userInput = document.getElementById('userInput');
            const wipeCanvasButton = document.getElementById('wipeCanvasButton');
            const accessCodeDisplay = document.createElement('div'); // Create access code display
            document.body.appendChild(accessCodeDisplay); // Append it to the body

            accessCodeDisplay.id = 'accessCodeDisplay'; // Set the ID for the access code display
            accessCodeDisplay.textContent = 'Access Code: '; // Initial text

            let isCanvasUnlocked = false;
            let cooldown = false;
            let pixelsPlaced = 0;
            let cooldownTime = 300; // 300 seconds (5 minutes)
            let countdownTimer;

            // Initialize pixel color
            let currentColor = colorPicker.value;

            // Array to keep track of placed pixels
            const placedPixels = [];
            const pixelSize = 10; // Adjusted pixel size

            // Function to generate a random 5-digit code
            function generateRandomCode() {
                return Math.floor(10000 + Math.random() * 90000).toString(); // Generates a random 5-digit code
            }

            // Function to check if it's Sunday after 17:00
            function isSundayAfterFive() {
                const now = new Date();
                return now.getDay() === 0 && now.getHours() >= 17; // Sunday = 0
            }

            // Function to load or generate the access code
            function loadOrGenerateAccessCode() {
                const lastGeneratedCode = localStorage.getItem('randomAccessCode');
                const lastGeneratedTime = localStorage.getItem('lastGeneratedTime');
                const now = new Date();

                if (lastGeneratedCode && lastGeneratedTime) {
                    const lastTime = new Date(parseInt(lastGeneratedTime));

                    // If it's Sunday after 17:00 and the last code was generated earlier, generate a new code
                    if (isSundayAfterFive() && now > lastTime) {
                        const newCode = generateRandomCode();
                        localStorage.setItem('randomAccessCode', newCode);
                        localStorage.setItem('lastGeneratedTime', Date.now());
                        accessCodeDisplay.textContent = `Access Code: ${newCode}`;
                    } else {
                        accessCodeDisplay.textContent = `Access Code: ${lastGeneratedCode}`; // Use the last generated code
                    }
                } else {
                    // Generate and store a new code if none exists
                    const newCode = generateRandomCode();
                    localStorage.setItem('randomAccessCode', newCode);
                    localStorage.setItem('lastGeneratedTime', Date.now());
                    accessCodeDisplay.textContent = `Access Code: ${newCode}`; // Display the new code
                }
            }

            // Call this function on page load
            loadOrGenerateAccessCode();

            // Update the current color display
            colorPicker.addEventListener('input', (e) => {
                currentColor = e.target.value;
            });

            // Function to place a pixel on the canvas
            function placePixel(x, y) {
                if (isCanvasUnlocked && !cooldown) {
                    const gridX = Math.floor(x / pixelSize) * pixelSize;
                    const gridY = Math.floor(y / pixelSize) * pixelSize;
                    const pixelKey = `${gridX},${gridY}`;

                    // Check if the pixel position is already occupied
                    if (!placedPixels.includes(pixelKey)) {
                        ctx.fillStyle = currentColor;
                        ctx.fillRect(gridX, gridY, pixelSize, pixelSize);
                        placedPixels.push(pixelKey);
                        pixelsPlaced++;

                        if (pixelsPlaced === 1) {
                            startCooldown(); // Start cooldown when the 1st pixel is placed
                        }
                    }
                }
            }

            // Function to start the cooldown
            function startCooldown(timeLeft = cooldownTime) {
                cooldown = true;
                const cooldownEnd = new Date().getTime() + (timeLeft * 1000);
                localStorage.setItem('cooldownEnd', cooldownEnd);
                updateCountdownDisplay(timeLeft);

                countdownTimer = setInterval(() => {
                    timeLeft--;
                    updateCountdownDisplay(timeLeft);

                    if (timeLeft <= 0) {
                        clearInterval(countdownTimer);
                        cooldown = false;
                        pixelsPlaced = 0; // Reset the pixel count
                        countdownDisplay.textContent = 'Cooldown: 0:00';
                        localStorage.removeItem('cooldownEnd'); // Clear cooldown end time
                    }
                }, 1000);
            }

            // Function to update countdown display
            function updateCountdownDisplay(timeLeft) {
                countdownDisplay.textContent = `Cooldown: ${Math.floor(timeLeft / 60)}:${String(timeLeft % 60).padStart(2, '0')}`;
            }

            // Add event listener for canvas click
            canvas.addEventListener('click', (e) => {
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;

                placePixel(x, y);
            });

            // Add event listener for submitting access code
            submitCodeButton.addEventListener('click', () => {
                const accessCode = localStorage.getItem('randomAccessCode');

                if (userInput.value === accessCode) {
                    overlay.style.display = 'none';
                    isCanvasUnlocked = true;
                    userInput.value = ''; // Clear the input field
                    wipeCanvasButton.style.display = 'block'; // Show the wipe canvas button
                } else {
                    alert('Incorrect access code. Please try again.');
                }
            });

            // Add event listener for the wipe canvas button
            wipeCanvasButton.addEventListener('click', () => {
                if (confirm('Are you sure you want to wipe the canvas?')) {
                    ctx.clearRect(0, 0, canvas.width, canvas.height); // Clear the canvas
                    placedPixels.length = 0; // Clear placed pixels
                    alert('Canvas has been wiped!');
                }
            });
        });
    </script>
</body>
</html>
