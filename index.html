<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pixel Wars</title>
    <style>
        body {
            font-family: 'Verdana', sans-serif;
            background-color: #2c2c2c;
            color: #e0e0e0;
            text-align: center;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 {
            margin-top: 20px;
            color: #ffcc00;
        }

        #pixelCanvas {
            border: 1px solid #555;
            margin-top: 20px;
            cursor: pointer;
            background-color: #ffffff;
        }

        #canvasContainer {
            position: relative;
        }

        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
        }

        #colorOptions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            align-items: center;
        }

        #accessSection {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #accessSection input {
            padding: 5px;
            margin-top: 10px;
            border-radius: 5px;
            border: 1px solid #555;
        }

        #wipeCanvasButton {
            margin-top: 20px;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            background-color: #ff5555;
            color: #ffffff;
            cursor: pointer;
            display: none; /* Initially hidden */
        }

        #countdown {
            color: #ffcc00; /* Countdown text color */
            margin-left: 10px;
        }

        #welcomeText {
            margin-top: 30px;
            max-width: 600px;
            text-align: left;
            font-size: 14px;
            background-color: #3c3c3c;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            color: #e0e0e0;
        }

        #welcomeText h2 {
            margin-bottom: 10px;
            font-size: 18px;
            color: #ffcc00;
        }

        #welcomeText ul {
            padding-left: 20px;
        }

        #welcomeText li {
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <h1>Pixel Wars</h1>
    <div id="canvasContainer">
        <canvas id="pixelCanvas" width="500" height="500"></canvas>
        <div class="overlay" id="overlay">Enter Access Code to Unlock Canvas</div>
    </div>
    
    <div id="colorOptions">
        <input type="color" id="colorPicker" value="#000000">
        <div id="countdown">Cooldown: 0:00</div>
    </div>

    <div id="accessSection">
        <label for="userInput">Enter Access Code:</label>
        <input type="text" id="userInput" placeholder="Enter your code here">
        <button id="submitCode">Submit</button>
    </div>

    <button id="wipeCanvasButton">Wipe Canvas</button>

    <div id="welcomeText">
        <h2>Welcome to Pixel Wars!</h2>
        <p>This space is all about collaboration and creativity. Go wild, be quirky, or team up with others to create something amazing. The image you create here will become our server banner at the end of every month. You've got one pixel every 5 minutes, so make it count!</p>
        <p>Here are some quick tips to get you started:</p>
        <ul>
            <li>Click on the canvas to place a pixel.</li>
            <li>Middle-click on the canvas to quickly pick a color thatâ€™s already been placed.</li>
            <li>You can replace any pixel, no matter who placed it there!</li>
        </ul>
        <p>Game on and happy pixeling!</p>
    </div>

    <script>
        const canvas = document.getElementById('pixelCanvas');
        const ctx = canvas.getContext('2d');
        const overlay = document.getElementById('overlay');
        const colorPicker = document.getElementById('colorPicker');
        const countdownDisplay = document.getElementById('countdown');
        const submitCodeButton = document.getElementById('submitCode');
        const userInput = document.getElementById('userInput');
        const wipeCanvasButton = document.getElementById('wipeCanvasButton');

        let isCanvasUnlocked = false;
        let cooldown = false;
        let pixelsPlaced = 0;
        let cooldownTime = 300; // 300 seconds (5 minutes)
        let countdownTimer;

        // Initialize pixel color
        let currentColor = colorPicker.value;

        // Function to place a pixel on the canvas
        function placePixel(x, y) {
            if (isCanvasUnlocked && !cooldown) {
                const pixelSize = 10; // Adjusted pixel size
                const gridX = Math.floor(x / pixelSize) * pixelSize;
                const gridY = Math.floor(y / pixelSize) * pixelSize;
                const pixelKey = `${gridX},${gridY}`;

                // Check if the pixel position is already occupied
                if (!placedPixels.includes(pixelKey)) {
                    ctx.fillStyle = currentColor;
                    ctx.fillRect(gridX, gridY, pixelSize, pixelSize); // Set pixel size to pixelSize x pixelSize
                    placedPixels.push(pixelKey);
                    pixelsPlaced++;

                    if (pixelsPlaced === 5) {
                        startCooldown(); // Start cooldown when the 5th pixel is placed
                    }
                }
            }
        }

        // Function to start the cooldown
        function startCooldown(timeLeft = cooldownTime) {
            cooldown = true;
            const cooldownEnd = new Date().getTime() + (timeLeft * 1000);
            localStorage.setItem('cooldownEnd', cooldownEnd);
            updateCountdownDisplay(timeLeft);

            countdownTimer = setInterval(() => {
                timeLeft--;
                updateCountdownDisplay(timeLeft);

                if (timeLeft <= 0) {
                    clearInterval(countdownTimer);
                    cooldown = false;
                    pixelsPlaced = 0; // Reset the pixel count
                    countdownDisplay.textContent = 'Cooldown: 0:00';
                    localStorage.removeItem('cooldownEnd'); // Clear cooldown end time
                }
            }, 1000);
        }

        // Function to update countdown display
        function updateCountdownDisplay(timeLeft) {
            countdownDisplay.textContent = `Cooldown: ${Math.floor(timeLeft / 60)}:${(timeLeft % 60).toString().padStart(2, '0')}`;
        }

        // Event listener to change color
        colorPicker.addEventListener('input', (e) => {
            currentColor = e.target.value; // Update the current color
        });

        // Function to handle mouse click events on the canvas
        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = Math.floor((e.clientX - rect.left));
            const y = Math.floor((e.clientY - rect.top));
            placePixel(x, y);
            saveCanvasState(); // Save the canvas state after placing a pixel
        });

        // Function to handle access code submission
        submitCodeButton.addEventListener('click', () => {
            const code = userInput.value.trim(); // Trim whitespace

            // Check if the entered code is correct
            if (code === "Itsameamario1") {
                overlay.style.display = 'none'; // Unlock the canvas
                isCanvasUnlocked = true; // Set the flag to unlock the canvas
                userInput.value = ''; // Clear the input field
                wipeCanvasButton.style.display = 'block'; // Show the wipe button
                restoreCooldown(); // Restore cooldown if applicable
            } else {
                alert("Incorrect access code. Please try again.");
            }
        });

        // Function to wipe the canvas
        wipeCanvasButton.addEventListener('click', () => {
            if (confirm("Are you sure you want to wipe the canvas? This action cannot be undone.")) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                placedPixels.length = 0; // Clear placed pixels
                pixelsPlaced = 0; // Reset pixel count
            }
        });

        // Function to save the canvas state in local storage
        function saveCanvasState() {
            localStorage.setItem('canvasState', canvas.toDataURL());
        }

        // Function to restore canvas state from local storage
        function restoreCanvasState() {
            const savedState = localStorage.getItem('canvasState');
            if (savedState) {
                const img = new Image();
                img.onload = () => {
                    ctx.drawImage(img, 0, 0);
                };
                img.src = savedState;
            }
        }

        // Function to restore cooldown
        function restoreCooldown() {
            const cooldownEnd = localStorage.getItem('cooldownEnd');
            if (cooldownEnd) {
                const remainingTime = Math.max(0, Math.floor((cooldownEnd - new Date().getTime()) / 1000));
                if (remainingTime > 0) {
                    startCooldown(remainingTime);
                }
            }
        }

        // Restore the canvas state and cooldown on page load
        window.onload = () => {
            restoreCanvasState();
            restoreCooldown();
        };
    </script>
</body>
</html>
